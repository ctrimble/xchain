<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Apr 7, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Christian Trimble" />
    <meta name="Date-Revision-yyyymmdd" content="20130407" />
    <meta http-equiv="Content-Language" content="en" />
    <title>XChain Framework - Creating Commands</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>XChain Framework : Core Module</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: Apr 07 2013</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 0.5.0-SNAPSHOT</li>
                          <li class="divider">|</li>             <li class="">
                    <a href="http://xiantrimble.com/xchain" class="externalLink" title="XChain Framework">
        XChain Framework</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="../index.html" title="Core Module">
        Core Module</a>
        </li>
      <li class="divider ">/</li>
        <li class="">Creating Commands</li>
                
                
            
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
            
                <ul class="nav nav-list">
                    <li class="nav-header">Core Module</li>
                                
      <li>
    
                          <a href="../index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                              <li class="nav-header">Documentation</li>
                                
      <li class="active">
    
            <a href="#"><i class="none"></i>Command Definition</a>
          </li>
                  
      <li>
    
                          <a href="../guides/attribute-definition.html" title="Attribute Defintiions">
          <i class="none"></i>
        Attribute Defintiions</a>
            </li>
                  
      <li>
    
                          <a href="../guides/lifecycle.html" title="Lifecycle">
          <i class="none"></i>
        Lifecycle</a>
            </li>
                  
      <li>
    
                          <a href="../guides/commands-that-output-sax.html" title="SAX Pipelines">
          <i class="none"></i>
        SAX Pipelines</a>
            </li>
                              <li class="nav-header">Namespaces</li>
                                
      <li>
    
                          <a href="../namespaces/core.html" title="Core">
          <i class="none"></i>
        Core</a>
            </li>
                  
      <li>
    
                          <a href="../namespaces/sax.html" title="SAX">
          <i class="none"></i>
        SAX</a>
            </li>
                  
      <li>
    
                          <a href="../namespaces/jsl.html" title="JSL">
          <i class="none"></i>
        JSL</a>
            </li>
                  
      <li>
    
                          <a href="../namespaces/csv.html" title="CSV">
          <i class="none"></i>
        CSV</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                                              
      <li>
    
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                    
      <li>
    
                          <a href="../project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
            
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!--  --><!-- Copyright 2011 meltmedia --><!--  --><!-- Licensed under the Apache License, Version 2.0 (the "License"); --><!-- you may not use this file except in compliance with the License. --><!-- You may obtain a copy of the License at --><!--  --><!-- http://www.apache.org/licenses/LICENSE-2.0 --><!--  --><!-- Unless required by applicable law or agreed to in writing, software --><!-- distributed under the License is distributed on an "AS IS" BASIS, --><!-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. --><!-- See the License for the specific language governing permissions and --><!-- limitations under the License. --><!--  --><!-- NOTE: For help with the syntax of this file, see: --><!-- http://maven.apache.org/doxia/references/apt-format.html --><div class="section"><h2><a name="Creating_Commands">Creating Commands</a></h2><div class="section"><h3>Overview<a name="Overview"></a></h3><p>In this guide we will create a very basic XChain Command and create an XChain Catalog that uses the command to produce output. There are several steps we will take in creating this command. First, we will add a file to our applications resources, so that XChains will scan our application for commands. Second, we will create a java package to hold our command and assign it a namespace. Third, we will define our new command. And finally, we will create a web page that uses our command to create output.</p></div><div class="section"><h3>Adding the jar to the class scanner.<a name="Adding_the_jar_to_the_class_scanner."></a></h3><p>The XChains Lifecycle will automatically scan for XChain Commands when the lifecycle starts. In order to reduce the number of jars that are scanned, the XChains class scanner only searches those jars and wars that contain the file META-INF/xchain.xml. The file does not need to contain any text. Simply by including a file with that name, an archive will be scanned.</p></div><div class="section"><h3>Defining the namespace for a package.<a name="Defining_the_namespace_for_a_package."></a></h3><p>The XChains class scanner only binds commands in packages that have an org.xchain.annotations.Namespace annotation. To get our new command working, we will define the package org.xchain.example.namespaces.guide and will bind that package to the namespace http://www.xchain.org/guide. To do this, we will create a package-info.java file in our package and add the needed annotation to the package.</p><div class="source"><pre class="prettyprint">/**
  * &lt;p&gt;The Guide command package.&lt;/p&gt;
  */
@org.xchain.annotations.Namespace(uri=&quot;http://www.xchain.org/guide&quot;)
package org.xchain.example.namespaces.guide;</pre></div><p>Now, any comands defined in this package will be in the http://www.xchain.org/guide namespace.</p></div><div class="section"><h3>Defining a hello world command<a name="Defining_a_hello_world_command"></a></h3><p>We are now ready to create a very basic command in the http://www.xchain.org/guide namespace. XChain Commands are implemented as abstract java classes that implement the org.xchain.Command interface, provide an org.xchain.annotations.Element annotation, and have an implementation of the execute method. This is a basic command that defines our hello variable in the context.</p><div class="source"><pre class="prettyprint">package org.xchain.example.namespaces.guide;

import javax.xml.namespace.QName;

import org.apache.commons.jxpath.JXPathContext;

import org.xchain.Command;
import org.xchain.annotations.Element;
import org.xchain.framework.jxpath.Scope;
import org.xchain.framework.jxpath.ScopedQNameVariables;

/**
 * &lt;p&gt;Definition of the {http://www.xchain.org/guide}hello-world command.  This command sets the variable {http://www.xchain.org/guide}hello
 * to the value &quot;Hello World&quot;.&lt;/p&gt;
 */
@Element(localName=&quot;hello-world&quot;)
public abstract class HelloWorldCommand
  implements Command
{
  /**
   * This method will be called when an {http://www.xchain.org/guide}hello-world element is encountered.
   *
   * @param context the context in which this command is called.
   */
  public boolean execute( JXPathContext context )
    throws Exception
  {
    // create a QName for the variable that we are going to set.
    QName name = QName.valueOf(&quot;{http://www.xchain.org/guide}hello&quot;);

    // declare the variable.  Out of the box, JXPath does not cleanly implement variables with
    // QNames and it does not have a concept of scope, so we will need to cast the variables
    // class to a org.xchain.framework.jxpath.ScopedQNameVariables class.
    ((ScopedQNameVariables)context.getVariables()).declareVariable(name, &quot;Hello World&quot;, Scope.chain);

    // return true, so that other chains will execute.
    return true;
   }
}</pre></div><p>This command has an Element annotation with a localName of hello-world, so it will be bound to the QName <a name="http:www.xchain.orgguide">http://www.xchain.org/guide</a>hello-world.</p></div><div class="section"><h3>Defining the hello world web page for our new command.<a name="Defining_the_hello_world_web_page_for_our_new_command."></a></h3><p>Now that we have our command defined, we need to use it. To do this we will define a new web page that calls the command to set our variable, and then we will output that variable from the user guide application. To do this, we need to create an xhtml file in the web application that contains an xml element for our new command. Then we will read the variable that it declares and output that to the document.</p><p>To do this, we are going to use the XChain JSL Namespace and an XChain Stylesheet Declaration to hide some of the details not related to defining and using a command. If you have not read the guides for these two features, please do so.</p><div class="source"><pre class="prettyprint">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;?xchain-stylesheet system-id=&quot;resource://context-class-loader/org/xchain/namespaces/servlet/xhtml.xsl&quot;?&gt;
&lt;html
  xmlns=&quot;http://www.w3.org/1999/xhtml&quot;
  xmlns:jsl=&quot;http://www.xchain.org/jsl/1.0&quot;
  xmlns:guide=&quot;http://www.xchain.org/guide&quot;&gt;

  &lt;!-- This calls the execute method of our command. --&gt;
  &lt;guide:hello-world/&gt;

  &lt;head&gt;
    &lt;title&gt;&lt;jsl:value-of select=&quot;$guide:hello&quot;/&gt;&lt;/title&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;!-- This outputs the variable to the browser. --&gt;
    &lt;h1&gt;&lt;jsl:value-of select=&quot;$guide:hello&quot;/&gt;&lt;/h1&gt;
  &lt;/body&gt;

&lt;/html&gt;</pre></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2013
                      XChain Framework.
            All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
